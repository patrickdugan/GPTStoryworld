{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Diplomacy Storyworld",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "id",
    "title",
    "turn_limit",
    "agents",
    "nodes",
    "initial_state",
    "rules"
  ],
  "properties": {
    "id": {
      "type": "string",
      "minLength": 1
    },
    "title": {
      "type": "string",
      "minLength": 1
    },
    "description": {
      "type": "string"
    },
    "turn_limit": {
      "type": "integer",
      "minimum": 1,
      "maximum": 50
    },
    "agents": {
      "type": "array",
      "minItems": 1,
      "maxItems": 5,
      "items": {
        "$ref": "agent.schema.json"
      }
    },
    "nodes": {
      "type": "array",
      "minItems": 1,
      "maxItems": 12,
      "items": {
        "$ref": "#/definitions/node"
      }
    },
    "initial_state": {
      "type": "object",
      "additionalProperties": false,
      "required": ["active_node", "beliefs", "coalitions", "world_vars"],
      "properties": {
        "active_node": {
          "type": "string",
          "minLength": 1
        },
        "beliefs": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/belief"
          }
        },
        "coalitions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/coalition"
          }
        },
        "world_vars": {
          "type": "object",
          "additionalProperties": {
            "type": ["number", "string", "boolean"]
          }
        }
      }
    },
    "rules": {
      "type": "object",
      "additionalProperties": false,
      "required": ["outcomes", "belief_update", "trust_bounds", "action_types", "message_types", "forecast_questions"],
      "properties": {
        "outcomes": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": {
            "$ref": "#/definitions/outcome"
          }
        },
        "belief_update": {
          "type": "object",
          "additionalProperties": {
            "type": "number"
          }
        },
        "trust_bounds": {
          "type": "object",
          "additionalProperties": false,
          "required": ["min", "max"],
          "properties": {
            "min": {"type": "number"},
            "max": {"type": "number"}
          }
        },
        "action_types": {
          "type": "array",
          "minItems": 1,
          "items": {"type": "string"}
        },
        "message_types": {
          "type": "array",
          "minItems": 1,
          "items": {"type": "string"}
        },
        "forecast_questions": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/forecast_question"
          }
        }
      }
    },
    "messages": {
      "type": "array",
      "items": {
        "$ref": "message.schema.json"
      }
    },
    "hidden_state": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/hidden_var"
      }
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true
    }
  },
  "definitions": {
    "node": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "label", "state_vars"],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "label": {
          "type": "string",
          "minLength": 1
        },
        "state_vars": {
          "type": "object",
          "additionalProperties": {
            "type": ["number", "string", "boolean"]
          }
        },
        "terminal": {
          "type": "boolean"
        }
      }
    },
    "belief": {
      "type": "object",
      "additionalProperties": false,
      "required": ["trust", "expected_payoff"],
      "properties": {
        "trust": {
          "type": "object",
          "additionalProperties": {
            "type": "number"
          }
        },
        "expected_payoff": {
          "type": "number"
        },
        "stance": {
          "type": "string"
        }
      }
    },
    "coalition": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "members", "stability"],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "members": {
          "type": "array",
          "minItems": 2,
          "items": {"type": "string"}
        },
        "stability": {
          "type": "number"
        }
      }
    },
    "outcome": {
      "type": "object",
      "additionalProperties": false,
      "required": ["next_node"],
      "properties": {
        "next_node": {
          "type": "string",
          "minLength": 1
        },
        "terminal": {
          "type": "boolean"
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "hidden_var": {
      "type": "object",
      "additionalProperties": false,
      "required": ["key", "type", "value"],
      "properties": {
        "key": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "enum": ["number", "string", "boolean"]
        },
        "value": {}
      }
    },
    "forecast_question": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "text", "outcomes"],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "text": {
          "type": "string",
          "minLength": 1
        },
        "outcomes": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
